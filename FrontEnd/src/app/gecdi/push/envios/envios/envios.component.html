<div class="row">

  <div class="col-md-12">
    <div class="row">


      <nb-card>
        <nb-card-header>
          <h1><i class="fa fa-file-export"></i> Envios de PUSH</h1>
        </nb-card-header>

        <nb-card-body>
          Data:
          <input nbInput placeholder="Hoje" [nbDatepicker]="dateTimePicker" [ngModel]="dataSelecionada" (ngModelChange)="changeDataSelecionada(dataSelecionada,$event)">
          <nb-datepicker #dateTimePicker format="dd/MMM/yyyy"></nb-datepicker>
          &nbsp;&nbsp;&nbsp;<button nbButton (click)="refreshEnvios()" ><i class="fas fa-sync"></i>&nbsp;Atualizar &nbsp;&nbsp;<span #atu></span></button>
          <BR><BR>
          <!-- <div class="float-right">Atualizado até <b>{{ parametros?.dDataHoraAtualizacao |  date:'dd/LL/yyyy HH:mm'  }}</b></div> -->
          <table class="table">
            <thead class="row-title">
              <tr class="row-title">
                <td scope="col">Hom</td>
                <td scope="col">ID<BR>Envio</td>
                <td scope="col">ID<BR>Sol.</td>
                <td scope="col">WF</td>
                <td scope="col">Data</td>
                <td scope="col">Hora</td>
                <td scope="col">Mensagem</td>
                <td scope="col">Qtd</td>
                <td scope="col">Arquivo</td>
                <td scope="col">Enviado</td>
                <td scope="col">Extras</td>
                <td scope="col">Cancelado</td>
                <td scope="col" *ngIf="e_admin">Excluir</td>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let e of envios | async; let i = index ;" [ngClass]="checkRow(e) + ' hand'">
                <th scope="row" class="no-wrap"         (click)="rowClick(e,i)"><nb-icon *ngIf="e?.homologado" icon="checkmark-square-outline" pack="eva" status="primary"></nb-icon></th>
                <th scope="row" class="no-wrap"         (click)="rowClick(e,i)">{{e?.idSolicitacao_Simulacao_Envio}}</th>
                <td scope="row" class="no-wrap"         (click)="rowClick(e,i)">{{e?.idSolicitacao_PUSH}}</td>
                <td scope="row" class="no-wrap"         (click)="rowClick(e,i)">{{e?.idSolicitacao_PUSHNavigation.wF_GECRM}}</td>
                <td scope="row" class="no-wrap"         (click)="rowClick(e,i)">{{e?.data  | date:'dd/MMM/yyyy'}}</td>
                <td scope="row" class="no-wrap"         (click)="rowClick(e,i)">{{e?.horaFormatado}}</td>
                <td scope="row" class="mensagem-limite" (click)="rowClick(e,i)">{{e?.idSolicitacao_PUSHNavigation?.mensagem}}</td>
                <td scope="row" class="no-wrap"         (click)="rowClick(e,i)">{{e?.quantidade | number:'0.':'pt-BR'}}</td>
                <td scope="row" class="mensagem-limite" (click)="rowClick(e,i)">{{e?.nome_Arquivo}}</td>
                <td scope="row"                         (click)="rowClick(e,i)">
                  <nb-toggle [ngModel]="e?.enviado" (ngModelChange)="changeCheckEnviado(e,$event)" status="success"></nb-toggle>
                </td>
                <td scope="row" class="no-wrap" (click)="rowClick(e)">...</td>
                <td scope="row"                         (click)="rowClick(e)">
                  <nb-toggle [ngModel]="e?.cancelado" (ngModelChange)="changeCheckCancelado(e,$event)" status="warning"></nb-toggle>
                </td>

                <td *ngIf="e_admin">
                  <button nbButton ghost *ngIf="!e?.enviado" (click)="excluirEnvio(e,dialogExcluir);"><nb-icon icon="trash" pack="eva" status="danger"></nb-icon></button>
                </td>
              </tr>
            </tbody>
          </table>

        </nb-card-body>

        <nb-card-footer>
          Footer
        </nb-card-footer>
      </nb-card>

    </div>
  </div>

</div>


<ngx-dialog-envio #diag [envio]="EnvioSelecionado" [position]="posicao" [listaEnvios]="envios | async"></ngx-dialog-envio>

<ng-template #dialogExcluir let-data let-ref="dialogRef">
  <nb-card>
    <nb-card-header>Confirmar Exclusão</nb-card-header>
    <nb-card-body>{{ data }}</nb-card-body>
    <nb-card-footer>
      <button nbButton status="primary" (click)="ref.close()"  >Não</button> &nbsp;&nbsp;
      <button nbButton status="danger" (click)="deletarEnvio(dialogExcluir);ref.close();"   >Sim</button>
    </nb-card-footer>
  </nb-card>
</ng-template>
